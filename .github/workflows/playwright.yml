name: QA Automation Staging Validation

on:
  # Triggered by frontend repo
  repository_dispatch:
    types: [ run-staging-tests ]

  # Triggered by QA code push
  push:
    branches: [ main ]

jobs:
  qa-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout QA repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install dependencies
        run: npm install

      - name: Run tests against STAGING
        env:
          BASE_URL: ${{ secrets.STAGING_BASE_URL }}
        run: |
          echo "Running tests against $BASE_URL"
          npm run test

      - name: Deploy Eligibility PASS
        if: success()
        run: |
          echo "DEPLOY ELIGIBLE"
          echo "All staging tests passed."

      - name: Deploy Eligibility FAIL
        if: failure()
        run: |
          echo "DEPLOY NOT ELIGIBLE"
          exit 1
